<%- include('partials/header', { user: (typeof user !== 'undefined' ? user : null), title: 'Inventory' }) %>

  <div class="container mt-4">
    <p class="text-muted mb-2">Welcome, <strong><%= user.username %></strong> (<%= user.role %>)</p>
    <% if (typeof user !== 'undefined' && user.role === 'admin') { %>
      <div class="alert alert-info inventory-alert" role="alert">
        <div class="d-flex align-items-start">
          <div class="me-2">
            <span class="inventory-pill">Admin</span>
          </div>
          <div>
            <strong>Inventory console</strong><br>
            Manage all GlowAura products here. Cart and shopping are disabled for admin accounts.
          </div>
        </div>
      </div>
    <% } %>

    <div class="inventory-header d-flex justify-content-between align-items-center mb-3">
      <div>
        <h2 class="mb-1">Product inventory</h2>
        <p class="text-muted mb-0">Monitor stock levels and pricing for every GlowAura SKU.</p>
      </div>
      <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
        <div class="ms-3">
          <button class="btn btn-dark inventory-add-btn" data-bs-toggle="modal" data-bs-target="#addProductModal">+ Add new product</button>
        </div>
      <% } %>
    </div>

    <div class="inventory-card">
      <table class="table table-hover align-middle mb-0 inventory-table">
        <thead>
          <tr>
            <th class="text-start">Product</th>
            <th>Image</th>
            <th>Stock</th>
            <th>Price</th>
            <th colspan="2">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% for(let i=0; i < products.length; i++) { const p = products[i]; const stock = Number(p.quantity) || 0; %>
            <tr>
              <td class="text-start">
                <a href="/product/<%= p.id %>" class="inventory-product-name"><%= p.productName %></a>
                <div class="inventory-product-meta">
                  <span class="badge bg-light text-dark"><%= p.category || 'Uncategorised' %></span>
                  <% if (stock <= 0) { %>
                    <span class="badge bg-danger ms-1">Out of stock</span>
                  <% } else if (stock < 5) { %>
                    <span class="badge bg-warning text-dark ms-1">Low stock</span>
                  <% } else { %>
                    <span class="badge bg-success ms-1">Healthy</span>
                  <% } %>
                </div>
              </td>
              <td>
                <div class="inventory-thumb-wrap">
                  <img src="/images/<%= p.image %>" class="inventory-thumb" alt="<%= p.productName %>">
                </div>
              </td>
              <td>
                <span class="inventory-stock-count"><%= stock %></span>
              </td>
              <td>
                <span class="inventory-price">$<%= (Number(p.price) || 0).toFixed(2) %></span>
              </td>
              <td>
                <a href="/updateProduct/<%= p.id %>" class="inventory-action-link">Edit</a>
              </td>
              <td>
                <a href="/deleteProduct/<%= p.id %>" class="inventory-action-link text-danger" onclick="return confirm('Are you sure you want to delete this product?')">Delete</a>
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  
    <!-- Add Product Modal (admin) -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <%- include('partials/addProductForm', { categories: (typeof categories !== 'undefined' ? categories : []) }) %>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast container (kept for other features) -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
      <div id="toastContainer"></div>
    </div>
  </div>
  <%- include('partials/footer') %>
