<%- include('partials/header', { user: (typeof user !== 'undefined' ? user : null), title: 'User Management' }) %>

<div class="container mt-5 mb-5 admin-users-wrapper">
  <div class="admin-users-shell">
    <header class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
      <div class="d-flex align-items-center gap-2">
        <div class="admin-users-orb">
          <span class="admin-users-icon">ðŸ‘¥</span>
        </div>
        <div>
          <p class="admin-users-kicker mb-1">Admin console</p>
          <h1 class="admin-users-title mb-0">User management</h1>
        </div>
      </div>
      <p class="text-muted mb-0 small">Total users: <strong><%= users.length %></strong></p>
    </header>

    <% if (errors && errors.length) { %>
      <div class="alert alert-danger"><%= errors.join('<br>') %></div>
    <% } %>
    <% if (success && success.length) { %>
      <div class="alert alert-success"><%= success.join('<br>') %></div>
    <% } %>

    <div class="table-responsive">
      <table class="table align-middle admin-users-table">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Role</th>
            <th scope="col">Tier</th>
            <th scope="col">Points</th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (!users || !users.length) { %>
            <tr><td colspan="7" class="text-center text-muted">No users found.</td></tr>
          <% } else { %>
            <% users.forEach(function(u){ %>
              <tr>
                <td><%= u.id %></td>
                <td><%= u.username %></td>
                <td><%= u.email %></td>
                <td>
                  <span class="badge <%= u.role === 'admin' ? 'bg-dark' : 'bg-secondary' %>"><%= u.role %></span>
                </td>
                <td>
                  <span class="admin-users-tier-pill tier-<%= (u.membership && u.membership.tierName || 'Bronze').toLowerCase() %>">
                    <%= u.membership && u.membership.tierName || 'Bronze' %>
                  </span>
                </td>
                <td><%= u.membership ? u.membership.points : (u.points || 0) %></td>
                <td class="text-end">
                  <% if (u.role !== 'admin') { %>
                    <form action="/admin/users/<%= u.id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Delete this user? This cannot be undone.');">
                      <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                    </form>
                  <% } else { %>
                    <span class="text-muted small">Protected</span>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
